#!/usr/bin/env node

/**
 * Module dependencies.
 */

var term = require('inquirer');
var join = require('path').join;
var read = require('fs').readFileSync;
var write = require('fs').writeFileSync;
var mkdir = require('fs').mkdirSync;
var exists = require('fs').existsSync;

// define `templates`
var templates = join(__dirname, '..', 'templates');
var pkg = join(templates, 'package.json');

// define `dir`
var cwd = process.cwd();
var dir = process.argv[2]
  ? cwd + '/' + process.argv[2]
  : cwd;

// create `dir`
if (exists(dir + '/package.json')) throw new Error('There is already a file with package.json.');
if (!exists(dir)) mkdir(dir);

/**
 * FAQ.
 */

var faq = survey([
  'name',
  'description',
  'homepage',
  'author'
]);

// prompt
console.log();
console.log('Project setup:');
term.prompt(faq, parse);

/**
 * Parse cli `answers`.
 * @param  {Object}
 */

function parse(answers){
  console.log();

  // equip `package.json`
  var file = equip(pkg, answers);

  // write file
  write(dir + '/package.json', file);

  // Fin!
  console.log('Done.');
}

/**
 * Equip `package.json` whith project infos.
 * @param  {String}
 * @param  {Object}
 * @return {String}
 */

function equip(f, o){
  var keys = Object.keys(o);
  var pkg = require(f);

  keys.forEach(function(data){
    pkg[data] = o[data];
  });

  return JSON.stringify(pkg, null, 2);
}

/**
 * Create survey questions.
 * @param  {Array}
 * @return {Array}
 */

function survey(arr){
  var quests = [];

  arr.forEach(function(item){
    quests.push({
      type: 'input',
      name: item,
      message: 'Project ' + item
    });
  });

  return quests;
}
